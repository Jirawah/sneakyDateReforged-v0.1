<main class="auth-wrap">
  <section class="auth-panel">
    <h2>Inscription</h2>

    <form [formGroup]="form" (ngSubmit)="submit()" class="auth-form">

      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" required />
        <mat-error *ngIf="form.get('email')?.hasError('required')">Email requis</mat-error>
        <mat-error *ngIf="form.get('email')?.hasError('email')">Format invalide</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Steam ID</mat-label>
        <input matInput formControlName="steamId" />
      </mat-form-field>

      <!-- Connexion Discord (UX) -->
      <div class="discord-connect">
        <mat-checkbox
          formControlName="discordConnected"
          class="discord-checkbox"
          color="primary">
          CONNEXION DISCORD
        </mat-checkbox>

        <button
          type="button"
          mat-raised-button
          class="btn-discord"
          (click)="openDiscordInvite()">
          Ouvrir Discord
        </button>
      </div>

      <mat-form-field appearance="outline">
        <mat-label>Mot de passe (≥12 caractères)</mat-label>
        <input matInput type="password" formControlName="password" required />
        <mat-error *ngIf="form.get('password')?.hasError('required')">Requis</mat-error>
        <mat-error *ngIf="form.get('password')?.hasError('minlength')">12 caractères min.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Confirmer le mot de passe</mat-label>
        <input matInput type="password" formControlName="confirmPassword" required />
        <mat-error *ngIf="form.get('confirmPassword')?.hasError('required')">Requis</mat-error>
      </mat-form-field>

      <button
        mat-flat-button
        color="primary"
        [disabled]="form.invalid || loading || !form.get('discordConnected')?.value">
        {{ loading ? 'Création…' : 'Créer mon compte' }}
      </button>

      <p *ngIf="error" class="auth-error">{{ error }}</p>

      <div class="auth-links">
        <a mat-button routerLink="/auth/login">J’ai déjà un compte</a>
      </div>
    </form>
  </section>
</main>
